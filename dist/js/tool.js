!function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=1)}([function(e,t){e.exports=function(e,t,a,n,r,s){var i,o=e=e||{},l=typeof e.default;"object"!==l&&"function"!==l||(i=e,o=e.default);var u,c="function"==typeof o?o.options:o;if(t&&(c.render=t.render,c.staticRenderFns=t.staticRenderFns,c._compiled=!0),a&&(c.functional=!0),r&&(c._scopeId=r),s?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},c._ssrRegister=u):n&&(u=n),u){var m=c.functional,d=m?c.render:c.beforeCreate;m?(c._injectStyles=u,c.render=function(e,t){return u.call(t),d(e,t)}):c.beforeCreate=d?[].concat(d,u):[u]}return{esModule:i,exports:o,options:c}}},function(e,t,a){a(2),e.exports=a(9)},function(e,t,a){Nova.booting(function(e,t,n){e.component("nova-mail",a(3))})},function(e,t,a){var n=a(0)(a(4),a(8),!1,null,null,null);e.exports=n.exports},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(5),r=a.n(n);t.default={props:["resourceName","resourceId","panel"],components:{SentMail:r.a},data:function(){return{mailTemplates:[],selectedTemplate:"",templateOverride:"",from:"",to:"",subject:"",baseMailUri:"/nova-api/nova-sent-mails",mails:{next_page_url:"",prev_page_url:"",resources:{}},model:{}}},mounted:function(){this.getMailTemplates(),this.getMailable(),this.getMails(this.mailsUri)},computed:{mailsUri:function(){return this.baseMailUri+"?page=1"},hasMails:function(){return Boolean(this.mails.length)},hasNextLink:function(){return Boolean(this.mails.next_page_url)},hasPrevLink:function(){return Boolean(this.mails.prev_page_url)},hasPagination:function(){return this.hasNextLink||this.hasPrevLink},mailsQueryParams:function(){return"&orderBy=created_at&orderByDirection=desc&viaResource="+this.resourceName+"&viaResourceId="+this.resourceId+"&viaRelationship=mails&relationshipType=hasMany"},canSend:function(){return""!=this.templateOverride&&this.templateOverride.length>0}},methods:{getMailTemplates:function(){var e=this;Nova.request().get("/nova-mail/templates").then(function(t){var a=t.data;return e.mailTemplates=a.templates||[]})},paginationClass:function(e){return e?"text-primary dim":"test-80 opacity-50"},getMailable:function(){var e=this;Nova.request().post("/nova-mail/mailable",{mailableClass:this.panel.fields[0].model,mailableId:this.resourceId}).then(function(t){var a=t.data;e.model=a.model,e.to=a.to})},getMails:function(e){var t=this;Nova.request().get(""+e+this.mailsQueryParams).then(function(e){var a=e.data;return t.mails=a})},handleSendMail:function(){var e=this;Nova.request().post("/nova-mail/send/"+(this.selectedTemplate.id||""),{model:this.panel.fields[0].model,resourceId:this.resourceId,content:this.templateOverride,from:this.from,to:this.to,subject:this.subject||this.selectedTemplate.subject}).then(function(t){t.data;e.getMails(e.mailsUri),e.resetForm(),e.$toasted.show("The mail has been sent.",{type:"success"})}).catch(function(t){return e.$toasted.show(t,{type:"error"})})},resetForm:function(){this.from="",this.subject="",this.templateOverride="",this.selectedTemplate=""}},watch:{selectedTemplate:function(e,t){this.templateOverride=this.selectedTemplate.content}}}},function(e,t,a){var n=a(0)(a(6),a(7),!1,null,null,null);e.exports=n.exports},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={props:{initialMail:{type:Object,require:!0}},data:function(){return{mail:{}}},mounted:function(){var e=this;axios.get("/nova-mail/sent-mail/"+this.initialMail.id.value).then(function(t){var a=t.data;return e.mail=a.mail})},computed:{date:function(){var e=moment(),t=moment.utc(this.mail.created_at).tz(moment.tz.guess());return t.isSame(e,"minute")?"just now":t.isSame(e,"day")?"at "+t.format("LT"):t.isSame(e,"year")?"on "+t.format("MMM D"):"on "+t.format("ll")}}}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"py-4 border-t border-40"},[a("div",{staticClass:"text-80 text-sm"},[e._v("Sent "+e._s(e.date))]),e._v(" "),a("br"),e._v(" "),a("div",{staticClass:"text-80 text-sm mb-2"},[a("strong",[e._v("\n      Subject:\n      "+e._s(e.mail.subject)+"\n    ")])]),e._v(" "),a("div",{staticClass:"italic"},[e.mail.content?[a("div",{domProps:{innerHTML:e._s(e.mail.content)}})]:[e._v("Content not available..")]],2)])},staticRenderFns:[]}},function(e,t){e.exports={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h4",{staticClass:"text-90 font-normal text-2xl mb-3"},[e._v("Mail")]),e._v(" "),a("div",{staticClass:"card mb-6 overflow-hidden"},[a("div",{staticClass:"flex border-b border-40 remove-bottom-border px-8"},[a("div",{staticClass:"w-full pt-6 pb-2"},[a("h3",{staticClass:"text-90 font-bold text-lg mb-4"},[e._v("Send Mail")]),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.from,expression:"from"}],staticClass:"w-full form-control form-input form-input-bordered mb-2",attrs:{name:"from",id:"from",dusk:"from",type:"text",placeholder:"[from] "+e.panel.fields[0].from},domProps:{value:e.from},on:{input:function(t){t.target.composing||(e.from=t.target.value)}}}),e._v(" "),a("input",{staticClass:"w-full form-control form-input form-input-bordered mb-2",attrs:{name:"to",id:"to",dusk:"to",type:"text",readonly:"true"},domProps:{value:e.to}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.subject,expression:"subject"}],staticClass:"w-full form-control form-input form-input-bordered mb-2",attrs:{name:"subject",id:"subject",dusk:"subject",type:"text",placeholder:"[subject] "+(e.selectedTemplate.subject||e.panel.fields[0].subject)},domProps:{value:e.subject},on:{input:function(t){t.target.composing||(e.subject=t.target.value)}}}),e._v(" "),a("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedTemplate,expression:"selectedTemplate"}],staticClass:"form-control form-select mb-2",attrs:{name:"mail_template_select",id:"mail-template-select",dusk:"mail-template-select"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.selectedTemplate=t.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"",disabled:"disabled"}},[e._v("Select Mail Template")]),e._v(" "),e._l(e.mailTemplates,function(t,n){return a("option",{key:n,domProps:{value:t}},[e._v(e._s(t.name))])})],2),e._v(" "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.templateOverride,expression:"templateOverride"}],staticClass:"w-full form-control form-input form-input-bordered py-3 h-auto",attrs:{name:"template_override",id:"template-override",dusk:"template-override",rows:"10",placeholder:"Adjust the mail template here or craft an email from scratch! You can use normal blade syntax and include attributes from this resources model..."},domProps:{value:e.templateOverride},on:{input:function(t){t.target.composing||(e.templateOverride=t.target.value)}}})])]),e._v(" "),a("div",{staticClass:"flex justify-between px-8 pb-4 border-b border-40"},[a("button",{staticClass:"btn btn-default btn-primary inline-flex items-center relative mt-4",attrs:{type:"submit",disabled:!e.canSend},on:{click:e.handleSendMail}},[e._v("Send Mail")])]),e._v(" "),e.mails.resources&&e.mails.resources.length>0?a("div",{staticClass:"flex border-b border-40 remove-bottom-border px-8"},[a("div",{staticClass:"w-full py-6"},[a("h3",{staticClass:"text-90 font-bold text-lg mb-4"},[e._v("Mail History")]),e._v(" "),e._l(e.mails.resources,function(e,t){return a("sent-mail",{key:t,attrs:{"initial-mail":e}})})],2)]):e._e(),e._v(" "),e.hasPagination?a("div",{staticClass:"bg-20 rounded-b"},[a("nav",{staticClass:"flex justify-between items-center"},[a("button",{staticClass:"btn btn-link py-3 px-4",class:e.paginationClass(e.hasNextLink),attrs:{disabled:!e.hasNextLink},on:{click:function(t){return e.getMails(e.mails.next_page_url)}}},[e._v("Older")]),e._v(" "),a("button",{staticClass:"btn btn-link py-3 px-4",class:e.paginationClass(e.hasPrevLink),attrs:{disabled:!e.hasPrevLink},on:{click:function(t){return e.getMails(e.mails.prev_page_url)}}},[e._v("Newer")])])]):e._e()])])},staticRenderFns:[]}},function(e,t){}]);